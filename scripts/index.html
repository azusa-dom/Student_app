<!DOCTYPE html>
<html lang="zhâ€‘CN">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=deviceâ€‘width, initialâ€‘scale=1.0"/>
  <title>ğŸ“ UCL AI é—®ç­”ç³»ç»Ÿ</title>
  <style>
    /* æ¸å˜èƒŒæ™¯ */
    body {
      margin:0; padding:0; boxâ€‘sizing:border-box;
      fontâ€‘family:-appleâ€‘system, BlinkMacSystemFont, "Segoe UI", "PingFang SC", "Microsoft YaHei", "Helvetica Neue", Arial, sansâ€‘serif;
      background: linearâ€‘gradient(135deg, #6a11cb, #8e44ad);
      minâ€‘height:100vh;
      color:#2d3748;
    }
    .container {
      maxâ€‘width:920px; margin:0 auto; padding:36px 18px;
    }
    header {
      textâ€‘align:center; marginâ€‘bottom:22px;
    }
    header h1 {
      color:#fff; fontâ€‘size:32px; fontâ€‘weight:800; marginâ€‘bottom:8px;
    }
    header p {
      color:#fff; opacity:.9;
    }
    .card {
      background:#fff; borderâ€‘radius:18px; padding:26px;
      boxâ€‘shadow:0 10px 40px rgba(0,0,0,.1);
    }
    .pills {
      display:flex; flexâ€‘wrap:wrap; gap:10px; marginâ€‘top:12px; marginâ€‘bottom:16px;
    }
    .pill {
      border:2px solid #8e44ad; color:#8e44ad;
      background:transparent; padding:9px 14px; borderâ€‘radius:999px;
      fontâ€‘size:14px; cursor:pointer; transition:.2s;
    }
    .pill:hover {
      background:#8e44ad; color:#fff;
    }
    .search {
      display:flex; gap:10px; marginâ€‘bottom:14px;
    }
    #q {
      flex:1; padding:13px 14px; border:2px solid #e2e8f0;
      borderâ€‘radius:12px; fontâ€‘size:15px;
    }
    #q:focus { outline:none; borderâ€‘color:#6a11cb; boxâ€‘shadow:0 0 0 3px rgba(106,17,203,.15); }
    #ask {
      background:#8e44ad; color:#fff; border:none; padding:13px 22px; borderâ€‘radius:12px;
      fontâ€‘size:15px; fontâ€‘weight:700; cursor:pointer; transition:.2s;
    }
    #ask:hover:not(:disabled) { background:#5b0fa0; }
    #ask:disabled { background:#aaa; cursor:notâ€‘allowed; }
    .loading, .error {
      padding:26px; color:#718096; textâ€‘align:center;
    }
    .spinner {
      width:40px; height:40px; border:4px solid rgba(106,17,203,.2);
      borderâ€‘topâ€‘color:#8e44ad; borderâ€‘radius:50%;
      margin:0 auto 10px; animation:spin .9s linear infinite;
    }
    @keyframes spin { to{transform:rotate(360deg);} }
    .intent {
      display:inlineâ€‘block; padding:6px 14px; borderâ€‘radius:18px;
      background:linearâ€‘gradient(135deg, #667eea, #764ba2); color:#fff;
      fontâ€‘weight:700; fontâ€‘size:13px; marginâ€‘bottom:10px;
    }
    .answer {
      background:#f7fafc; borderâ€‘left:4px solid #8e44ad;
      padding:14px; borderâ€‘radius:8px; whiteâ€‘space:pre-wrap; lineâ€‘height:1.8; marginâ€‘bottom:14px;
    }
    .answer a { color:#8e44ad; textâ€‘decoration:none; }
    .answer a:hover { textâ€‘decoration:underline; }
    .stats {
      display:flex; gap:12px; margin:10px 0 16px;
    }
    .stat {
      flex:1; background:#f7fafc; borderâ€‘radius:10px;
      padding:12px; textâ€‘align:center;
      color:#4a5568;
    }
    .stat .k { fontâ€‘size:12px; color:#a0aec0; }
    .stat .v { fontâ€‘size:18px; fontâ€‘weight:800; color:#8e44ad; }
    .src {
      borderâ€‘top:2px solid #e2e8f0; paddingâ€‘top:12px;
    }
    .src h4 {
      fontâ€‘size:14px; color:#a0aec0; marginâ€‘bottom:8px;
    }
    .src ul { listâ€‘style:none; padding:0; margin:0; }
    .src li {
      background:#f7fafc; padding:10px; borderâ€‘radius:8px; marginâ€‘bottom:8px;
    }
    .src a { color:#8e44ad; textâ€‘decoration:none; wordâ€‘break:break-all; }
    .src a:hover { textâ€‘decoration:underline; }
    @media (maxâ€‘width:768px){
      .container { padding:22px 12px; }
      .card { padding:18px; borderâ€‘radius:14px; }
      .search { flexâ€‘direction:column; }
      #ask { width:100%; }
      .stats { flexâ€‘direction:column; }
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>ğŸ“ UCL AI é—®ç­”ç³»ç»Ÿ</h1>
      <p>æ™ºèƒ½æ£€ç´¢ Â· æ„å›¾è¯†åˆ« Â· ç²¾å‡†å›ç­”</p>
    </header>
    <div class="card">
      <div style="color:#718096;fontâ€‘size:14px">ğŸ’¡ è¯•è¯•è¿™äº›é—®é¢˜ï¼š</div>
      <div class="pills">
        <button class="pill" onclick="setQ('è®¡ç®—æœºç§‘å­¦ç¡•å£«çš„è¯­è¨€è¦æ±‚')">è®¡ç®—æœºç§‘å­¦ç¡•å£«çš„è¯­è¨€è¦æ±‚</button>
        <button class="pill" onclick="setQ('å¦‚ä½•é¢„çº¦å¿ƒç†å’¨è¯¢')">å¦‚ä½•é¢„çº¦å¿ƒç†å’¨è¯¢</button>
        <button class="pill" onclick="setQ('å•†ç§‘ç¡•å£«å…¥å­¦è¦æ±‚')">å•†ç§‘ç¡•å£«å…¥å­¦è¦æ±‚</button>
        <button class="pill" onclick="setQ('ç®€å†å’Œæ±‚èŒå‡†å¤‡')">ç®€å†å’Œæ±‚èŒå‡†å¤‡</button>
      </div>
      <div class="search">
        <input id="q" type="text" placeholder="è¯·è¾“å…¥ä½ çš„é—®é¢˜ï¼Œä¾‹å¦‚ï¼šè®¡ç®—æœºç§‘å­¦ç¡•å£«çš„è¯­è¨€è¦æ±‚"/>
        <button id="ask" onclick="ask()">æé—®</button>
      </div>
      <div id="stage"></div>
    </div>
  </div>
  <script>
    const q = document.getElementById('q');
    const askBtn = document.getElementById('ask');
    const stage = document.getElementById('stage');
    q.addEventListener('keyup', e => { if (e.key==='Enter') ask(); });

    function setQ(text){ q.value = text; q.focus(); }

    function loadingView(){
      stage.innerHTML = `
        <div class="loading">
          <div class="spinner"></div>
          æ­£åœ¨æ£€ç´¢å’Œç”Ÿæˆç­”æ¡ˆï¼Œè¯·ç¨å€™â€¦
        </div>`;
    }
    function errorView(msg){
      stage.innerHTML = `<div class="error">âŒ ç³»ç»Ÿé”™è¯¯ï¼š${msg || 'è¿æ¥å¤±è´¥'}</div>`;
    }

    async function ask(){
      const text = (q.value||'').trim();
      if(!text){ q.focus(); return; }
      askBtn.disabled = true; askBtn.textContent='æ€è€ƒä¸­â€¦';
      loadingView();

      try {
        const res = await fetch('/api/qa', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ query: text, top_k: 2 })
        });
        if(!res.ok) throw new Error(`HTTP ${res.status}`);
        const data = await res.json();
        render(data);
      } catch(e){
        errorView(e.message);
      } finally {
        askBtn.disabled=false; askBtn.textContent='æé—®';
      }
    }

    function render(data){
      const intent = data.intent || 'å…¶ä»–';
      const answer = data.answer || 'å½“å‰è¯­æ–™æ— è¯¥ä¿¡æ¯ã€‚';
      stage.innerHTML = `
        <div class="intent">${intent}</div>
        <div class="answer">${answer.replace(/\\n/g,'<br/>')}</div>
        <div class="stats">
          <div class="stat"><div class="k">æ£€ç´¢æ–‡æ¡£</div><div class="v">${data.num_docs}</div></div>
          <div class="stat"><div class="k">æŸ¥è¯¢æ”¹å†™</div><div class="v">${data.num_queries}</div></div>
          <div class="stat"><div class="k">å“åº”æ—¶é—´</div><div class="v">${data.response_time}</div></div>
        </div>
        ${renderSources(data.citations)}
      `;
    }
    function renderSources(sources){
      if (!Array.isArray(sources) || sources.length===0) return '';
      const lis = sources.map((s,i)=>`<li>${i+1}. <a href="${s.url}" target="_blank">${s.title}</a></li>`).join('');
      return `
        <div class="src">
          <h4>ğŸ“ å‚è€ƒæ¥æº</h4>
          <ul>${lis}</ul>
        </div>
      `;
    }
  </script>
</body>
</html>
