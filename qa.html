<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ğŸ“ UCL AI é—®ç­”ç³»ç»Ÿ</title>
  <style>
    /* â€”â€”â€” é«˜çº§ç´«è‰²æ¸å˜ + åœ†è§’ + ç»ç’ƒæ€ â€”â€”â€” */
    *{margin:0;padding:0;box-sizing:border-box}
    body{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI","PingFang SC",sans-serif;
      min-height:100vh;padding:24px;background:linear-gradient(135deg,#667eea,#764ba2)}
    .container{max-width:900px;margin:0 auto}
    .header{text-align:center;color:#fff;margin-bottom:24px}
    .header h1{font-size:2.4rem;margin-bottom:8px}
    .card{background:#fff;border-radius:16px;padding:24px;
      box-shadow:0 12px 36px rgba(0,0,0,.12)}
    .pills{display:flex;flex-wrap:wrap;gap:10px;margin:10px 0 16px}
    .pill{border:2px solid #667eea;background:transparent;color:#667eea;
      padding:8px 16px;border-radius:999px;cursor:pointer;transition:.2s}
    .pill:hover{background:#667eea;color:#fff}
    .search{display:flex;gap:10px;margin-bottom:14px}
    #q{flex:1;padding:12px 14px;border:2px solid #e6e6f5;border-radius:10px;font-size:15px}
    #q:focus{outline:none;border-color:#667eea;box-shadow:0 0 0 3px rgba(102,126,234,.18)}
    #ask{background:#667eea;color:#fff;border:none;padding:12px 22px;border-radius:10px;
      font-weight:700;cursor:pointer;transition:.2s}
    #ask:hover:not(:disabled){background:#5568d3}
    #ask:disabled{background:#9aa4ff;cursor:not-allowed}
    .intent{display:inline-block;padding:6px 12px;border-radius:14px;
      background:linear-gradient(135deg,#667eea,#764ba2);color:#fff;font-weight:700;font-size:13px;margin-bottom:12px}
    .answer{background:#f8f9fc;border-left:4px solid #667eea;padding:16px;border-radius:8px;white-space:pre-wrap;line-height:1.8;margin-bottom:14px}
    .answer a{color:#667eea;text-decoration:none}
    .answer a:hover{text-decoration:underline}
    .stats{display:grid;grid-template-columns:repeat(3,1fr);gap:12px;margin:8px 0 14px}
    .stat{background:#f8f9fc;border-radius:10px;padding:12px;text-align:center}
    .stat .k{font-size:12px;color:#7a84a2}.stat .v{font-size:20px;font-weight:800;color:#667eea}
    .src{border-top:2px solid #eee;padding-top:10px}
    .src h4{font-size:14px;color:#667eea;margin-bottom:8px}
    .src ul{list-style:none}
    .src li{background:#f8f9fc;padding:10px;border-radius:8px;margin-bottom:8px;border-left:3px solid transparent;transition:.2s}
    .src li:hover{background:#eef2ff;border-left-color:#667eea;transform:translateX(2px)}
    .loading,.error{padding:28px;text-align:center;color:#7a84a2}
    .spinner{width:40px;height:40px;border:4px solid rgba(102,126,234,.22);border-top-color:#667eea;border-radius:50%;margin:0 auto 10px;animation:spin .9s linear infinite}
    @keyframes spin{to{transform:rotate(360deg)}}
    @media(max-width:768px){.search{flex-direction:column}.stats{grid-template-columns:1fr}}
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>ğŸ“ UCL AI é—®ç­”ç³»ç»Ÿ</h1>
      <p>æ™ºèƒ½æ£€ç´¢ Â· æ„å›¾è¯†åˆ« Â· ç²¾å‡†å›ç­”</p>
    </div>

    <div class="card">
      <div style="color:#eef;opacity:.95;margin-bottom:8px">ğŸ’¡ è¯•è¯•è¿™äº›é—®é¢˜</div>
      <div class="pills">
        <button class="pill" onclick="setQ('è®¡ç®—æœºç§‘å­¦ç¡•å£«çš„è¯­è¨€è¦æ±‚')">è®¡ç®—æœºç§‘å­¦ç¡•å£«çš„è¯­è¨€è¦æ±‚</button>
        <button class="pill" onclick="setQ('å¦‚ä½•é¢„çº¦å¿ƒç†å’¨è¯¢')">å¦‚ä½•é¢„çº¦å¿ƒç†å’¨è¯¢</button>
        <button class="pill" onclick="setQ('å•†ç§‘ç¡•å£«å…¥å­¦è¦æ±‚')">å•†ç§‘ç¡•å£«å…¥å­¦è¦æ±‚</button>
        <button class="pill" onclick="setQ('ç®€å†å’Œæ±‚èŒå‡†å¤‡')">ç®€å†å’Œæ±‚èŒå‡†å¤‡</button>
      </div>

      <div class="search">
        <input id="q" type="text" placeholder="è¯·è¾“å…¥ä½ çš„é—®é¢˜ï¼Œä¾‹å¦‚ï¼šè®¡ç®—æœºç§‘å­¦ç¡•å£«çš„è¯­è¨€è¦æ±‚" />
        <button id="ask" onclick="ask()">æé—®</button>
      </div>

      <div id="stage"></div>
    </div>
  </div>

  <script>
    const q = document.getElementById('q');
    const askBtn = document.getElementById('ask');
    const stage = document.getElementById('stage');
    q.addEventListener('keyup', e => { if (e.key === 'Enter') ask(); });

    const INTENT_TEXT = {
      admission_requirements: 'ğŸ“š å…¥å­¦è¦æ±‚',
      careers_resume: 'ğŸ’¼ èŒä¸šå‘å±•',
      wellbeing_support: 'â¤ï¸ å¥åº·æ”¯æŒ',
      booking: 'ğŸ“… é¢„çº¦æœåŠ¡',
      other: 'ğŸ“„ å…¶ä»–',
      error: 'âŒ é”™è¯¯'
    };

    function setQ(text){ q.value = text; q.focus(); }

    function loading(){
      stage.innerHTML = `
        <div class="loading">
          <div class="spinner"></div>
          æ­£åœ¨æ£€ç´¢å’Œæ€»ç»“ï¼Œè¯·ç¨å€™â€¦
        </div>`;
    }
    function errorView(msg){
      stage.innerHTML = `<div class="error">âŒ ç³»ç»Ÿé”™è¯¯ï¼š${msg||'è¿æ¥å¤±è´¥'}</div>`;
    }

    async function ask(){
      const text = (q.value||'').trim();
      if(!text){ q.focus(); return; }
      askBtn.disabled = true; askBtn.textContent = 'æ€è€ƒä¸­â€¦';
      loading();
      const t0 = Date.now();
      try{
        // èµ° Vite ä»£ç†åˆ° 5051
        const res = await fetch(`/api/qa?query=${encodeURIComponent(text)}`);
        if(!res.ok) throw new Error(`HTTP ${res.status}`);
        const data = await res.json();
        render(data, ((Date.now()-t0)/1000).toFixed(2)+'s');
      }catch(e){
        errorView(e.message);
      }finally{
        askBtn.disabled = false; askBtn.textContent = 'æé—®';
      }
    }

    function render(data, cost='-'){
      const intent = INTENT_TEXT[data.intent] || data.intent || 'å…¶ä»–';
      let answer = data.answer || 'å½“å‰è¯­æ–™æ— è¯¥ä¿¡æ¯ã€‚';
      if (Array.isArray(data.citations) && data.citations.length>0){
        const c0 = data.citations[0];
        if (c0 && c0.url) answer += `\n\næ¥æºï¼š<a href="${c0.url}" target="_blank">${c0.title||c0.url}</a>`;
      }
      const docs = data.num_docs ?? (data.citations?.length||0);
      const rewrites = data.num_queries ?? '-';

      stage.innerHTML = `
        <div class="intent">${intent}</div>
        <div class="answer">${answer.replace(/\n/g,'<br/>')}</div>
        <div class="stats">
          <div class="stat"><div class="k">æ£€ç´¢æ–‡æ¡£</div><div class="v">${docs}</div></div>
          <div class="stat"><div class="k">æŸ¥è¯¢æ”¹å†™</div><div class="v">${rewrites}</div></div>
          <div class="stat"><div class="k">å“åº”æ—¶é—´</div><div class="v">${cost}</div></div>
        </div>
        ${renderSources(data.citations)}
      `;
    }
    function renderSources(cites){
      if (!Array.isArray(cites) || cites.length===0) return '';
      const lis = cites.map((s,i)=>`
        <li>
          <strong>${i+1}. ${s.title||'ç›¸å…³é¡µé¢'}</strong><br/>
          <a href="${s.url}" target="_blank">${s.url}</a>
        </li>`).join('');
      return `<div class="src"><h4>ğŸ”— å‚è€ƒæ¥æº</h4><ul>${lis}</ul></div>`;
    }
  </script>
</body>
</html>
