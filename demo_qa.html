<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>üéì UCL AI Assistant - Purple Glass Edition</title>
  <style>
    /* ... ÊâÄÊúâÊ†∑Âºè‰øùÊåÅ‰∏çÂèòÔºåÁúÅÁï•‰ª•ËäÇÁúÅÁ©∫Èó¥ ... */
    * { margin: 0; padding: 0; box-sizing: border-box; }
    :root {
      --primary: #8B7BE8;
      --primary-dark: #6B5BC7;
      --primary-light: #A896F0;
      --secondary: #48bb78;
      --bg-gradient-1: #667eea;
      --bg-gradient-2: #764ba2;
      --text-dark: #2d3748;
      --text-light: #718096;
      --white: #ffffff;
      --error: #e53e3e;
      --success: #48bb78;
    }
    body { 
      font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, var(--bg-gradient-1), var(--bg-gradient-2));
      background-attachment: fixed;
      min-height: 100vh;
      color: var(--text-dark);
      padding: 20px;
      position: relative;
      -webkit-font-smoothing: antialiased;
    }
    body::before {
      content: '';
      position: fixed;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: 
        radial-gradient(circle at 20% 50%, rgba(139, 123, 232, 0.3) 0%, transparent 50%),
        radial-gradient(circle at 80% 80%, rgba(167, 139, 250, 0.3) 0%, transparent 50%),
        radial-gradient(circle at 40% 20%, rgba(192, 132, 252, 0.2) 0%, transparent 50%);
      animation: float 20s ease-in-out infinite;
      z-index: -1;
    }
    @keyframes float {
      0%, 100% { transform: translate(0, 0) rotate(0deg); }
      33% { transform: translate(30px, -30px) rotate(5deg); }
      66% { transform: translate(-20px, 20px) rotate(-5deg); }
    }
    .container { max-width: 1100px; margin: 0 auto; }
    header { text-align: center; margin-bottom: 48px; color: var(--white); animation: fadeInDown 0.8s ease; }
    .header-content { display: flex; align-items: center; justify-content: center; gap: 16px; margin-bottom: 16px; }
    .logo { font-size: 64px; animation: float-logo 3s ease-in-out infinite; filter: drop-shadow(0 8px 24px rgba(139, 123, 232, 0.5)); }
    @keyframes float-logo { 0%, 100% { transform: translateY(0) scale(1); } 50% { transform: translateY(-15px) scale(1.05); } }
    h1 { font-size: 52px; font-weight: 800; text-shadow: 0 4px 20px rgba(0,0,0,0.3); line-height: 1.2; background: linear-gradient(135deg, #ffffff 0%, #E9D5FF 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
    .subtitle { font-size: 20px; opacity: 0.95; margin-top: 12px; font-weight: 500; text-shadow: 0 2px 10px rgba(0, 0, 0, 0.2); }
    .lang-toggle { position: absolute; top: 24px; right: 24px; background: rgba(255,255,255,0.25); backdrop-filter: blur(20px); border-radius: 30px; padding: 6px; display: flex; gap: 6px; box-shadow: 0 8px 24px rgba(139, 123, 232, 0.3); border: 1px solid rgba(255, 255, 255, 0.3); z-index: 100; }
    .lang-btn { background: transparent; border: none; color: rgba(255, 255, 255, 0.9); padding: 10px 20px; border-radius: 24px; font-size: 15px; font-weight: 700; cursor: pointer; transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); }
    .lang-btn.active { background: var(--white); color: var(--primary); box-shadow: 0 4px 12px rgba(139, 123, 232, 0.4); transform: scale(1.05); }
    .lang-btn:hover:not(.active) { background: rgba(255, 255, 255, 0.15); }
    .status { background: rgba(255,255,255,0.25); backdrop-filter: blur(10px); padding: 12px 20px; border-radius: 16px; margin-top: 16px; font-size: 14px; display: inline-block; font-weight: 600; border: 1px solid rgba(255, 255, 255, 0.3); transition: all 0.3s; }
    .card { background: rgba(255, 255, 255, 0.85); backdrop-filter: blur(40px) saturate(180%); border-radius: 28px; padding: 40px; box-shadow: 0 8px 40px rgba(139, 123, 232, 0.25); border: 1px solid rgba(255, 255, 255, 0.5); animation: fadeInUp 0.8s ease 0.2s both; position: relative; }
    .card::before { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 2px; background: linear-gradient(90deg, transparent, rgba(255,255,255,0.6), transparent); }
    .section-title { font-size: 24px; font-weight: 700; margin-bottom: 24px; color: var(--text-dark); }
    .questions-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); gap: 16px; margin-bottom: 40px; }
    .question-card { background: linear-gradient(135deg, rgba(255,255,255,0.95), rgba(255,255,255,0.8)); backdrop-filter: blur(20px); border: 2px solid rgba(139, 123, 232, 0.15); border-radius: 20px; padding: 24px; cursor: pointer; transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1); position: relative; overflow: hidden; }
    .question-card::before { content: ''; position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: linear-gradient(135deg, var(--primary), var(--primary-light)); opacity: 0; transition: opacity 0.4s; z-index: 0; }
    .question-card:hover { transform: translateY(-8px) scale(1.02); box-shadow: 0 12px 40px rgba(139, 123, 232, 0.35); border-color: var(--primary); }
    .question-card:hover::before { opacity: 0.12; }
    .question-card:active { transform: translateY(-4px) scale(0.98); }
    .question-content { position: relative; z-index: 1; }
    .question-icon { font-size: 36px; margin-bottom: 12px; display: block; filter: drop-shadow(0 2px 6px rgba(0,0,0,0.1)); }
    .question-text { font-size: 15px; font-weight: 600; line-height: 1.5; margin-bottom: 8px; color: var(--text-dark); }
    .question-category { font-size: 13px; color: var(--text-light); font-weight: 600; }
    .search-section { margin-bottom: 32px; }
    .search-box { position: relative; margin-bottom: 16px; display: flex; align-items: stretch; gap: 12px; }
    .search-icon { position: absolute; left: 20px; top: 50%; transform: translateY(-50%); font-size: 20px; z-index: 1; opacity: 0.5; }
    #q { flex: 1; padding: 18px 20px 18px 56px; border: 2px solid rgba(139, 123, 232, 0.2); border-radius: 18px; font-size: 17px; font-weight: 500; transition: all 0.3s; background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px); color: var(--text-dark); }
    #q:focus { outline: none; border-color: var(--primary); box-shadow: 0 0 0 4px rgba(139, 123, 232, 0.15); background: rgba(255, 255, 255, 1); }
    #q::placeholder { color: var(--text-light); }
    #ask { background: linear-gradient(135deg, var(--primary), var(--primary-dark)); color: white; border: none; padding: 18px 36px; border-radius: 18px; font-size: 17px; font-weight: 700; cursor: pointer; transition: all 0.3s; box-shadow: 0 4px 16px rgba(139, 123, 232, 0.4); position: relative; overflow: hidden; }
    #ask::before { content: ''; position: absolute; top: 50%; left: 50%; width: 0; height: 0; background: rgba(255, 255, 255, 0.3); border-radius: 50%; transform: translate(-50%, -50%); transition: width 0.6s, height 0.6s; }
    #ask:hover:not(:disabled)::before { width: 300px; height: 300px; }
    #ask:hover:not(:disabled) { transform: translateY(-2px); box-shadow: 0 6px 24px rgba(139, 123, 232, 0.5); }
    #ask:active:not(:disabled) { transform: translateY(0); }
    #ask:disabled { background: linear-gradient(135deg, #B8B8B8, #999999); cursor: not-allowed; box-shadow: none; }
    .search-hint { font-size: 14px; color: var(--text-light); text-align: center; font-weight: 500; }
    .loading { text-align: center; padding: 60px 20px; }
    .spinner { width: 60px; height: 60px; border: 5px solid rgba(139, 123, 232, 0.2); border-top-color: var(--primary); border-radius: 50%; margin: 0 auto 24px; animation: spin 0.8s linear infinite; box-shadow: 0 0 20px rgba(139, 123, 232, 0.3); }
    @keyframes spin { to { transform: rotate(360deg); } }
    .loading-text { font-size: 18px; color: var(--text-dark); font-weight: 700; margin-bottom: 8px; }
    .loading-subtext { font-size: 14px; color: var(--text-light); font-weight: 500; }
    .answer-container { animation: fadeInUp 0.6s ease; }
    .intent-badge { display: inline-block; background: linear-gradient(135deg, rgba(139, 123, 232, 0.15), rgba(139, 123, 232, 0.08)); color: var(--primary); padding: 10px 20px; border-radius: 20px; font-size: 14px; font-weight: 700; margin-bottom: 20px; border: 2px solid rgba(139, 123, 232, 0.3); }
    .answer-box { background: linear-gradient(135deg, rgba(255,255,255,0.95), rgba(255,255,255,0.85)); backdrop-filter: blur(20px); border-left: 5px solid var(--primary); border-radius: 20px; padding: 32px; line-height: 1.9; margin-bottom: 28px; box-shadow: 0 4px 20px rgba(139, 123, 232, 0.1); font-size: 17px; }
    .answer-box strong { color: var(--primary); font-weight: 700; }
    .stats { display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px; margin-bottom: 28px; }
    .stat { background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(10px); border-radius: 16px; padding: 20px; text-align: center; border: 1px solid rgba(139, 123, 232, 0.1); }
    .stat-label { font-size: 13px; color: var(--text-light); margin-bottom: 8px; font-weight: 600; }
    .stat-value { font-size: 28px; font-weight: 800; color: var(--primary); }
    .stat-value small { font-size: 16px; }
    .sources { border-top: 2px solid rgba(139, 123, 232, 0.2); padding-top: 28px; margin-top: 28px; }
    .sources h4 { font-size: 18px; color: var(--text-dark); margin-bottom: 20px; font-weight: 700; }
    .source-item { background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(10px); padding: 18px 24px; border-radius: 16px; margin-bottom: 12px; border-left: 4px solid var(--primary); transition: all 0.4s; display: flex; align-items: center; gap: 16px; border: 1px solid rgba(139, 123, 232, 0.1); }
    .source-item:hover { background: rgba(255, 255, 255, 1); transform: translateX(8px); box-shadow: 0 4px 20px rgba(139, 123, 232, 0.2); border-left-width: 6px; }
    .source-number { background: linear-gradient(135deg, var(--primary), var(--primary-dark)); color: white; width: 32px; height: 32px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 14px; font-weight: 700; flex-shrink: 0; }
    .source-item a { color: var(--primary); text-decoration: none; flex: 1; display: flex; align-items: center; gap: 8px; }
    .source-item a::after { content: '‚Üí'; font-size: 18px; transition: transform 0.3s; }
    .source-item:hover a::after { transform: translateX(6px); }
    .source-content { flex: 1; }
    .source-title { font-weight: 700; font-size: 15px; color: var(--text-dark); }
    .source-score { font-size: 12px; color: var(--text-light); font-weight: 600; }
    .error { background: rgba(229, 62, 62, 0.1); backdrop-filter: blur(10px); border-left: 5px solid var(--error); padding: 24px; border-radius: 16px; color: var(--error); }
    .error-title { font-weight: 700; font-size: 18px; margin-bottom: 8px; }
    @keyframes fadeInDown { from { opacity: 0; transform: translateY(-30px); } to { opacity: 1; transform: translateY(0); } }
    @keyframes fadeInUp { from { opacity: 0; transform: translateY(30px); } to { opacity: 1; transform: translateY(0); } }
    @media (max-width: 768px) {
      body { padding: 16px; }
      h1 { font-size: 40px; }
      .logo { font-size: 48px; }
      .card { padding: 28px; }
      .questions-grid { grid-template-columns: 1fr; }
      .search-box { flex-direction: column; }
      #ask { width: 100%; }
      .stats { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>
  <div class="lang-toggle">
    <button class="lang-btn" data-lang="zh" onclick="switchLanguage('zh')">‰∏≠Êñá</button>
    <button class="lang-btn active" data-lang="en" onclick="switchLanguage('en')">English</button>
  </div>
  
  <div class="container">
    <header>
      <div class="header-content">
        <span class="logo">üéì</span>
      </div>
      <h1><span data-i18n="title">UCL AI Assistant</span></h1>
      <p class="subtitle" data-i18n="subtitle">Enhanced Search ¬∑ Intelligent Retrieval ¬∑ Accurate Answers</p>
      <div class="status" id="status">
        <span data-i18n="status-connecting">Connecting...</span>
      </div>
    </header>

    <div class="card">
      <h3 class="section-title">
        <span data-i18n="quick-questions">üí° Quick Questions</span>
      </h3>
      <div class="questions-grid" id="questionsGrid"></div>

      <div class="search-section">
        <h3 class="section-title">
          <span data-i18n="custom-query">üîç Custom Query</span>
        </h3>
        <div class="search-box">
          <span class="search-icon">üîé</span>
          <input 
            id="q" 
            data-i18n-placeholder="search-placeholder"
            placeholder="Enter your question, e.g., What modules are in Data Science MSc?"
            onkeypress="if(event.key==='Enter')ask()"
          />
          <button id="ask" onclick="ask()">
            <span data-i18n="ask-btn">Ask</span>
          </button>
        </div>
        <p class="search-hint" data-i18n="search-hint">üí° Supports both Chinese and English queries</p>
      </div>

      <div id="stage"></div>
    </div>
  </div>

  <script>
    // üî• Êîπ‰∏∫Áõ∏ÂØπË∑ØÂæÑÔºàËá™Âä®ÈÄÇÈÖçÈÉ®ÁΩ≤ÁéØÂ¢ÉÔºâ
    const API_BASE = window.location.origin;  // ‰ΩøÁî®ÂΩìÂâçÂüüÂêç
    // ÊàñËÄÖ‰ΩøÁî®Á©∫Â≠óÁ¨¶‰∏≤ÔºàÊé®ËçêÔºâ
    // const API_BASE = '';
    
    const translations = {
      zh: {
        title: 'UCL AI Âä©Êâã',
        subtitle: 'Â¢ûÂº∫ÁâàÊ£ÄÁ¥¢ ¬∑ Êô∫ËÉΩÊ£ÄÁ¥¢ ¬∑ Á≤æÂáÜÂõûÁ≠î',
        'status-connecting': 'Ê≠£Âú®ËøûÊé•...',
        'status-connected': 'ÂêéÁ´ØÂ∑≤ËøûÊé• (Â¢ûÂº∫ÁâàÊ£ÄÁ¥¢)',
        'status-disconnected': 'ÂêéÁ´ØÊú™ÂêØÂä®',
        'quick-questions': 'üí° Âø´ÈÄüÈóÆÈ¢ò',
        'custom-query': 'üîç Ëá™ÂÆö‰πâÊü•ËØ¢',
        'search-placeholder': 'ËØ∑ËæìÂÖ•ÊÇ®ÁöÑÈóÆÈ¢òÔºå‰æãÂ¶ÇÔºöData Science MSc ÊúâÂì™‰∫õËØæÁ®ãÊ®°ÂùóÔºü',
        'ask-btn': 'ÊèêÈóÆ',
        'search-hint': 'üí° ÊîØÊåÅ‰∏≠Ëã±ÊñáÊèêÈóÆÔºåÂèØËØ¢ÈóÆ‰∏ì‰∏ö‰ø°ÊÅØ„ÄÅÂÖ•Â≠¶Ë¶ÅÊ±Ç„ÄÅËØæÁ®ãÊ®°ÂùóÁ≠â',
        'thinking': 'ÊÄùËÄÉ‰∏≠...',
        'searching': 'üîç Êô∫ËÉΩÊ£ÄÁ¥¢‰∏≠...',
        'analyzing': 'Ê≠£Âú®ÂàÜÊûêÁõ∏ÂÖ≥‰ø°ÊÅØ...',
        'error-title': '‚ùå Êü•ËØ¢Âá∫Èîô',
        'sources-title': 'üîó ÂèÇËÄÉÊù•Ê∫ê',
        'stat-docs': 'Ê£ÄÁ¥¢ÊñáÊ°£',
        'stat-time': 'ÂìçÂ∫îÊó∂Èó¥',
        'stat-intent': 'ÊÑèÂõæËØÜÂà´',
        questions: [
          { icon: 'üìä', text: 'ËØ∑ÈóÆ Data Science MSc ‰∏ì‰∏öÊúâÂì™‰∫õÊ†∏ÂøÉËØæÁ®ãÊ®°ÂùóÔºü', category: 'ËØæÁ®ã‰ø°ÊÅØ', query: 'What are the core modules in Data Science MSc?' },
          { icon: 'üíª', text: 'Áî≥ËØ∑ Computer Science MSc ÈúÄË¶ÅÊª°Ë∂≥‰ªÄ‰πàËØ≠Ë®ÄË¶ÅÊ±ÇÔºü', category: 'ÂÖ•Â≠¶Ë¶ÅÊ±Ç', query: 'Computer Science MSc language requirements' },
          { icon: 'üß†', text: 'ÊàëÊÉ≥‰∫ÜËß£ UCL ÁöÑÂøÉÁêÜÂí®ËØ¢ÊúçÂä°ÔºåÂ¶Ç‰ΩïÈ¢ÑÁ∫¶Ôºü', category: 'Â≠¶ÁîüÊúçÂä°', query: 'Â¶Ç‰ΩïÈ¢ÑÁ∫¶ÂøÉÁêÜÂí®ËØ¢' },
          { icon: 'üìà', text: 'Business Analytics MSc ÁöÑÂÖ•Â≠¶Ë¶ÅÊ±ÇÂíåÁî≥ËØ∑Êù°‰ª∂ÊòØ‰ªÄ‰πàÔºü', category: 'Áî≥ËØ∑‰ø°ÊÅØ', query: 'Business Analytics MSc entry requirements' }
        ]
      },
      en: {
        title: 'UCL AI Assistant',
        subtitle: 'Enhanced Search ¬∑ Intelligent Retrieval ¬∑ Accurate Answers',
        'status-connecting': 'Connecting...',
        'status-connected': 'Backend Connected (Enhanced)',
        'status-disconnected': 'Backend Not Running',
        'quick-questions': 'üí° Quick Questions',
        'custom-query': 'üîç Custom Query',
        'search-placeholder': 'Enter your question, e.g., What modules are in Data Science MSc?',
        'ask-btn': 'Ask',
        'search-hint': 'üí° Supports both Chinese and English queries about programs, requirements, modules, etc.',
        'thinking': 'Thinking...',
        'searching': 'üîç Searching intelligently...',
        'analyzing': 'Analyzing relevant information...',
        'error-title': '‚ùå Query Error',
        'sources-title': 'üîó Reference Sources',
        'stat-docs': 'Documents',
        'stat-time': 'Response Time',
        'stat-intent': 'Intent Detection',
        questions: [
          { icon: 'üìä', text: 'What are the core modules in the Data Science MSc program?', category: 'Course Info', query: 'What are the core modules in Data Science MSc?' },
          { icon: 'üíª', text: 'What are the language requirements for Computer Science MSc?', category: 'Entry Requirements', query: 'Computer Science MSc language requirements' },
          { icon: 'üß†', text: 'How can I book a psychological counseling session at UCL?', category: 'Student Services', query: 'How to book psychological counseling at UCL' },
          { icon: 'üìà', text: 'What are the entry requirements for Business Analytics MSc?', category: 'Application Info', query: 'Business Analytics MSc entry requirements' }
        ]
      }
    };
    
    let currentLang = 'en';
    const q = document.getElementById('q');
    const askBtn = document.getElementById('ask');
    const stage = document.getElementById('stage');
    const status = document.getElementById('status');
    const questionsGrid = document.getElementById('questionsGrid');
    
    function init() {
      renderQuestions();
      checkBackend();
      setInterval(checkBackend, 30000);
      console.log('[UCL AI] Initialized, API_BASE:', API_BASE);
    }
    
    function switchLanguage(lang) {
      currentLang = lang;
      document.querySelectorAll('.lang-btn').forEach(btn => {
        btn.classList.toggle('active', btn.dataset.lang === lang);
      });
      document.querySelectorAll('[data-i18n]').forEach(el => {
        const key = el.dataset.i18n;
        el.textContent = translations[lang][key] || key;
      });
      const placeholder = document.querySelector('[data-i18n-placeholder]');
      if (placeholder) {
        placeholder.placeholder = translations[lang]['search-placeholder'];
      }
      renderQuestions();
      checkBackend();
    }
    
    function renderQuestions() {
      const questions = translations[currentLang].questions;
      questionsGrid.innerHTML = questions.map(q => `
        <div class="question-card" onclick="quickAsk('${escapeHtml(q.query)}')">
          <div class="question-content">
            <span class="question-icon">${q.icon}</span>
            <div class="question-text">${q.text}</div>
            <div class="question-category">${q.category}</div>
          </div>
        </div>
      `).join('');
    }
    
    async function checkBackend() {
      try {
        console.log('[Health Check] Checking:', API_BASE + '/api/health');
        const response = await fetch(API_BASE + '/api/health');
        console.log('[Health Check] Response:', response.ok, response.status);
        if (response.ok) {
          status.innerHTML = '‚úÖ ' + translations[currentLang]['status-connected'];
          status.style.background = 'rgba(72,187,120,0.3)';
          return true;
        }
      } catch (e) {
        console.error('[Health Check] Failed:', e);
      }
      status.innerHTML = '‚ùå ' + translations[currentLang]['status-disconnected'];
      status.style.background = 'rgba(229,62,62,0.3)';
      return false;
    }
    
    function quickAsk(text) {
      q.value = text;
      setTimeout(ask, 150);
    }
    
    async function ask() {
      const text = (q.value || '').trim();
      if (!text) {
        q.focus();
        return;
      }
      
      askBtn.disabled = true;
      askBtn.innerHTML = '<span data-i18n="thinking">' + translations[currentLang]['thinking'] + '</span>';
      
      stage.innerHTML = `
        <div class="loading">
          <div class="spinner"></div>
          <div class="loading-text">${translations[currentLang]['searching']}</div>
          <div class="loading-subtext">${translations[currentLang]['analyzing']}</div>
        </div>
      `;
      
      try {
        console.log('[Query]', text, '| Language:', currentLang);
        const url = API_BASE + '/api/qa?query=' + encodeURIComponent(text) + '&language=' + currentLang;
        console.log('[Request URL]', url);
        const response = await fetch(url);
        console.log('[Status]', response.status);
        
        if (!response.ok) throw new Error('HTTP ' + response.status);
        
        const data = await response.json();
        console.log('[Data]', data);
        
        renderAnswer(data);
      } catch (error) {
        console.error('[Error]', error);
        stage.innerHTML = `
          <div class="error">
            <div class="error-title">${translations[currentLang]['error-title']}</div>
            <div>${escapeHtml(error.message)}</div>
          </div>
        `;
      } finally {
        askBtn.disabled = false;
        askBtn.innerHTML = '<span data-i18n="ask-btn">' + translations[currentLang]['ask-btn'] + '</span>';
      }
    }
    
    function renderAnswer(data) {
      const intent = data.intent || 'general';
      let answer = data.answer || 'Êú™ÊâæÂà∞Áõ∏ÂÖ≥‰ø°ÊÅØ';
      
      answer = escapeHtml(answer)
        .replace(/\n/g, '<br/>')
        .replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>')
        .replace(/‚Ä¢ /g, '&bull; ');
      
      const docs = data.num_docs || 0;
      const responseTime = data.response_time || '-';
      
      const intentLabels = {
        modules: 'üìö ËØæÁ®ãÊ®°Âùó',
        requirements: '‚úÖ ÂÖ•Â≠¶Ë¶ÅÊ±Ç',
        career: 'üíº ËÅå‰∏öÂèëÂ±ï',
        fees: 'üí∞ Â≠¶Ë¥πÊü•ËØ¢',
        general: 'üîç ÈÄöÁî®Êü•ËØ¢'
      };
      
      let sourcesHtml = '';
      if (data.citations && data.citations.length > 0) {
        sourcesHtml = `
          <div class="sources">
            <h4>${translations[currentLang]['sources-title']}</h4>
            ${data.citations.map((source, index) => {
              const scoreText = source.relevance_score 
                ? `<span class="source-score">Áõ∏ÂÖ≥Â∫¶: ${source.relevance_score}</span>` 
                : '';
              return `
                <div class="source-item">
                  <div class="source-number">${index + 1}</div>
                  <a href="${escapeHtml(source.url)}" target="_blank">
                    <div class="source-content">
                      <div class="source-title">${escapeHtml(source.title)}</div>
                      ${scoreText}
                    </div>
                  </a>
                </div>
              `;
            }).join('')}
          </div>
        `;
      }
      
      stage.innerHTML = `
        <div class="answer-container">
          <div class="intent-badge">
            ${intentLabels[intent] || 'üîç ' + intent}
          </div>
          <div class="answer-box">${answer}</div>
          <div class="stats">
            <div class="stat">
              <div class="stat-label">${translations[currentLang]['stat-docs']}</div>
              <div class="stat-value">${docs}</div>
            </div>
            <div class="stat">
              <div class="stat-label">${translations[currentLang]['stat-time']}</div>
              <div class="stat-value">${responseTime.replace('s', '<small>s</small>')}</div>
            </div>
            <div class="stat">
              <div class="stat-label">${translations[currentLang]['stat-intent']}</div>
              <div class="stat-value">‚úì</div>
            </div>
          </div>
          ${sourcesHtml}
        </div>
      `;
    }
    
    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }
    
    init();
  </script>
</body>
</html>